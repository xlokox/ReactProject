@startuml Make Payment Use Case
!theme plain
skinparam backgroundColor #f8f9fa

title Use Case: תשלום (Payment)

|User|
start
:משתמש בעמוד התשלום;
:צפייה בסיכום ההזמנה;

if (אמצעי התשלום?) then (כרטיס אשראי)
  :מילוי פרטי כרטיס:
  - מספר כרטיס
  - תאריך תפוגה
  - CVV
  - שם בעל הכרטיס;
  
  |Payment Gateway|
  :אימות פרטי הכרטיס;
  
  if (פרטים תקינים?) then (כן)
    :ביצוע חיוב;
    if (התשלום אושר?) then (כן)
      |System|
      :עדכון סטטוס ההזמנה ל"שולם";
      :הפחתת מלאי;
      :יצירת חשבונית;
      :שליחת אימייל אישור;
      |User|
      :הצגת עמוד הצלחה;
      :הצגת מספר הזמנה;
      :אפשרות להדפיס חשבונית;
    else (לא)
      |User|
      :הצגת שגיאת תשלום;
      :אפשרות לנסות שוב;
    endif
  else (לא)
    |User|
    :הצגת שגיאת פרטי כרטיס;
  endif

else (PayPal)
  |Payment Gateway|
  :הפניה לאתר PayPal;
  |User|
  :התחברות ל-PayPal;
  :אישור התשלום;
  |Payment Gateway|
  :החזרה לאתר עם אישור;
  |System|
  :עדכון סטטוס ההזמנה;
  :הפחתת מלאי;
  |User|
  :הצגת עמוד הצלחה;

else (העברה בנקאית)
  |System|
  :יצירת פרטי העברה;
  |User|
  :הצגת פרטי העברה:
  - מספר חשבון
  - סכום
  - קוד זיהוי;
  :ביצוע העברה בנקאית;
  |System|
  :המתנה לאישור העברה;
  :עדכון סטטוס לאחר קבלת התשלום;
endif

if (התשלום הושלם?) then (כן)
  |System|
  :ניקוי עגלת הקניות;
  :שליחת הודעה למוכר;
  :עדכון דוחות מכירות;
  |User|
  :קבלת אימייל עם פרטי ההזמנה;
  stop
else (לא)
  |User|
  :חזרה לעמוד התשלום;
  stop
endif

note right
  **Use Case:** תשלום
  **Actors:** משתמש, Payment Gateway
  **תיאור:** ביצוע התשלום בפועל דרך מערכת חיצונית
  
  **תנאים מוקדמים:**
  - הזמנה נוצרה במערכת
  - פרטי משלוח מלאים
  - אמצעי תשלום נבחר
  
  **תוצאה מוצלחת:**
  - התשלום אושר ונגבה
  - ההזמנה עודכנה לסטטוס "שולם"
  - המלאי הופחת
  - נשלח אימייל אישור
  
  **אמצעי תשלום נתמכים:**
  - כרטיס אשראי (Stripe)
  - PayPal
  - העברה בנקאית
  
  **אבטחה:**
  - הצפנת פרטי כרטיס
  - אימות PCI DSS
  - אימות 3D Secure
end note

@enduml
